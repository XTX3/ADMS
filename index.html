<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù†Ø¸Ø§Ù… Ø¬Ø±Ø¯ Ø§Ù„Ù‡ÙˆØ§ØªÙ</title>
  <style>
    body{font-family:Arial, sans-serif;background:#f7f7f7;margin:0}
    header{background:#007bff;color:#fff;padding:1rem;text-align:center}
    nav{display:flex;justify-content:center;gap:1rem;background:#e0e0e0;padding:.5rem}
    nav button{padding:.5rem 1rem;border:0;border-radius:5px;background:#007bff;color:#fff;cursor:pointer}
    section{display:none;padding:1rem} section.active{display:block}
    input,button{margin:.3rem 0;padding:.5rem;width:100%;box-sizing:border-box}
    button[disabled]{opacity:.5;cursor:not-allowed}
    table{width:100%;border-collapse:collapse;margin-top:1rem;background:#fff}
    th,td{border:1px solid #999;padding:.5rem;text-align:center}
    .stats-box{background:#fff;border:1px solid #ccc;border-radius:8px;padding:1rem;margin:1rem 0}
    .message{color:#d00;margin:.2rem 0;font-size:.9rem}
  </style>
</head>
<body>
  <header><h1>Ù†Ø¸Ø§Ù… Ø¬Ø±Ø¯ Ø§Ù„Ù‡ÙˆØ§ØªÙ</h1></header>

  <nav>
    <button onclick="showSection('add')">ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†</button>
    <button onclick="showSection('sell')">ğŸ’° Ø¨ÙŠØ¹ Ø¬Ù‡Ø§Ø²</button>
    <button onclick="showSection('stats')">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
  </nav>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© -->
  <section id="add" class="active">
    <h2>Ø¥Ø¶Ø§ÙØ© Ù‡Ø§ØªÙ Ù„Ù„Ù…Ø®Ø²Ù†</h2>
    <input id="addName"     placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© (Ù…Ø«Ù„Ø§Ù‹: Samsung)">
    <input id="addType"     placeholder="Ø§Ù„Ù†ÙˆØ¹ (Ù…Ø«Ù„Ø§Ù‹: A14)">
    <input id="addRam"      placeholder="Ø§Ù„Ø±Ø§Ù… (Ù…Ø«Ù„Ø§Ù‹: 4GB)">
    <input id="addStorage"  placeholder="Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ù…Ø«Ù„Ø§Ù‹: 128GB)">
    <input id="addQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
    <button onclick="addPhone()">â• Ø¥Ø¶Ø§ÙØ©</button>

    <h3>ğŸ“‹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†</h3>
    <table id="stockTable">
      <thead><tr><th>Ø§Ù„Ø´Ø±ÙƒØ©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø±Ø§Ù…</th><th>Ø§Ù„Ø°Ø§ÙƒØ±Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>ØªØ¹Ø¯ÙŠÙ„</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨ÙŠØ¹ -->
  <section id="sell">
    <h2>Ø¨ÙŠØ¹ Ù‡Ø§ØªÙ</h2>

    <input list="deviceSuggestions" id="sellName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©"
           oninput="fillDetailsFromSuggestion()">
    <datalist id="deviceSuggestions"></datalist>

    <input id="sellType"     placeholder="Ø§Ù„Ù†ÙˆØ¹">
    <input id="sellRam"      placeholder="Ø§Ù„Ø±Ø§Ù…">
    <input id="sellStorage"  placeholder="Ø§Ù„Ø°Ø§ÙƒØ±Ø©">
    <input id="sellQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©" oninput="toggleSellBtn()">

    <span id="sellMsg" class="message"></span>

    <button id="sellBtn" onclick="sellBtnHandler()" disabled>ğŸ’³ Ø¨ÙŠØ¹</button>
    <button onclick="clearSellForm()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>

    <h3>ğŸ“„ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</h3>
    <table id="salesTable">
      <thead><tr><th>Ø§Ù„Ø´Ø±ÙƒØ©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ø±Ø§Ù…</th><th>Ø§Ù„Ø°Ø§ÙƒØ±Ø©</th><th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</th><th>ØªØ¹Ø¯ÙŠÙ„</th><th>Ø­Ø°Ù</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <section id="stats">
    <h2>Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>
    <div class="stats-box">
      <p><strong>ğŸ“¦ Ø¹Ø¯Ø¯ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†:</strong> <span id="totalStock">0</span></p>
      <p><strong>ğŸ’° Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©:</strong> <span id="totalSold">0</span></p>
      <p><strong>ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</strong> <span id="stockQty">0</span></p>
    </div>
  </section>

  <script>
    let storage = JSON.parse(localStorage.getItem("phones")) || [];
    let sales   = JSON.parse(localStorage.getItem("sales"))  || [];

    let editIndex = null;          // ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
    let editSaleIndex = null;      // ØªØ¹Ø¯ÙŠÙ„ Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª

    function showSection(id){
      document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      if(id==="stats") updateStats();
      if(id==="add")   renderStockTable();
      if(id==="sell")  { renderSalesTable(); updateSuggestions(); clearSellForm(); }
    }

    function saveData(){
      localStorage.setItem("phones", JSON.stringify(storage));
      localStorage.setItem("sales",  JSON.stringify(sales));
    }

    // Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø§Ø² Ø£Ùˆ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
    function addPhone(){
      if(editIndex !== null){
        saveEditedPhone();
        return;
      }
      const name   = addName.value.trim(),
            type   = addType.value.trim(),
            ram    = addRam.value.trim(),
            stor   = addStorage.value.trim(),
            qty    = parseInt(addQty.value.trim());

      if(!name||!type||!ram||!stor||isNaN(qty)||qty<=0){ alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return;}

      const item = storage.find(p=>p.name===name&&p.type===type&&p.ram===ram&&p.storage===stor);
      item ? item.qty+=qty : storage.push({name,type,ram,storage:stor,qty});
      saveData(); renderStockTable(); alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
      addName.value=addType.value=addRam.value=addStorage.value=addQty.value="";
    }

    // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨ÙŠØ¹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
    function fillDetailsFromSuggestion(){
      const txt = sellName.value;
      const p   = storage.find(d => (`${d.name} - ${d.type} - ${d.ram} - ${d.storage}`)===txt);
      if(p){
        sellName.value=p.name; sellType.value=p.type; sellRam.value=p.ram; sellStorage.value=p.storage;
        sellMsg.textContent=""; toggleSellBtn(); return;
      }
      sellType.value=sellRam.value=sellStorage.value="";
      toggleSellBtn();
      if(txt && !storage.some(d => d.name.toLowerCase()===txt.toLowerCase())){
        sellMsg.textContent="Ø§Ù„Ø¬Ù‡Ø§Ø² ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†"; sellBtn.disabled=true;
      }else sellMsg.textContent="";
    }

    // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø¹Ù†Ø¯ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function toggleSellBtn(){
      const qty = parseInt(sellQty.value);
      const valid =
        sellName.value && sellType.value && sellRam.value && sellStorage.value &&
        !isNaN(qty) && qty>0 &&
        storage.some(p=> p.name===sellName.value && p.type===sellType.value &&
                         p.ram===sellRam.value && p.storage===sellStorage.value && p.qty>=qty);
      sellBtn.disabled = !valid;
    }

    // ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹
    function sellPhone(){
      const name=sellName.value.trim(), type=sellType.value.trim(),
            ram=sellRam.value.trim(),   stor=sellStorage.value.trim(),
            qty=parseInt(sellQty.value.trim());

      const idx = storage.findIndex(p=>p.name===name&&p.type===type&&p.ram===ram&&p.storage===stor);
      if(idx===-1||storage[idx].qty<qty){ alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©"); return;}

      storage[idx].qty-=qty; if(storage[idx].qty===0) storage.splice(idx,1);
      sales.push({name,type,ram,storage:stor,qty});
      saveData(); renderStockTable(); renderSalesTable(); updateStats(); alert("ØªÙ… Ø§Ù„Ø¨ÙŠØ¹");
      clearSellForm();
    }

    // Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¨ÙŠØ¹
    function clearSellForm(){
      sellName.value=sellType.value=sellRam.value=sellStorage.value=sellQty.value="";
      sellMsg.textContent=""; sellBtn.disabled=true;
      editSaleIndex = null;
      document.getElementById('sellBtn').textContent = "ğŸ’³ Ø¨ÙŠØ¹";
    }

    // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù† ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø²Ø± ØªØ¹Ø¯ÙŠÙ„
    function renderStockTable(){
      const tbody = stockTable.querySelector("tbody"); tbody.innerHTML="";
      storage.forEach((p,i)=>{
        tbody.insertAdjacentHTML("beforeend",
          `<tr>
            <td>${p.name}</td><td>${p.type}</td><td>${p.ram}</td><td>${p.storage}</td><td>${p.qty}</td>
            <td><button onclick="editPhone(${i})">ØªØ¹Ø¯ÙŠÙ„</button></td>
          </tr>`);
      });
      updateSuggestions();
    }

    // Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø¹ Ø²Ø±ÙŠ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù
    function renderSalesTable(){
      const tbody = salesTable.querySelector("tbody"); tbody.innerHTML="";
      sales.forEach((s,i)=>{
        tbody.insertAdjacentHTML("beforeend",
          `<tr>
            <td>${s.name}</td><td>${s.type}</td><td>${s.ram}</td><td>${s.storage}</td><td>${s.qty}</td>
            <td><button onclick="editSale(${i})">ØªØ¹Ø¯ÙŠÙ„</button></td>
            <td><button onclick="deleteSale(${i})">Ø­Ø°Ù</button></td>
          </tr>`);
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙÙŠ Ø§Ù„Ø¨ÙŠØ¹
    function updateSuggestions(){
      const dlist = deviceSuggestions;
      dlist.innerHTML = "";
      storage.forEach(p=>{
        let val = `${p.name} - ${p.type} - ${p.ram} - ${p.storage}`;
        dlist.insertAdjacentHTML("beforeend",`<option value="${val}">`);
      });
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ù‡Ø§Ø² ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
    function editPhone(i){
      editIndex = i;
      const p = storage[i];
      addName.value = p.name;
      addType.value = p.type;
      addRam.value = p.ram;
      addStorage.value = p.storage;
      addQty.value = p.qty;
      showSection("add");
    }

    // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø®Ø²Ù†
    function saveEditedPhone(){
      const name   = addName.value.trim(),
            type   = addType.value.trim(),
            ram    = addRam.value.trim(),
            stor   = addStorage.value.trim(),
            qty    = parseInt(addQty.value.trim());

      if(!name||!type||!ram||!stor||isNaN(qty)||qty<=0){ alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"); return;}

      // ØªØ­Ø¯ÙŠØ«
      storage[editIndex] = {name,type,ram,storage:stor,qty};
      editIndex = null;
      saveData();
      renderStockTable();
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
      addName.value=addType.value=addRam.value=addStorage.value=addQty.value="";
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø³Ø¬Ù„ Ø¨ÙŠØ¹
    function editSale(i){
      editSaleIndex = i;
      const s = sales[i];
      sellName.value = s.name;
      sellType.value = s.type;
      sellRam.value = s.ram;
      sellStorage.value = s.storage;
      sellQty.value = s.qty;
      sellMsg.textContent="";
      sellBtn.textContent = "ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
      showSection("sell");
      toggleSellBtn();
    }

    // Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¨ÙŠØ¹
    function saveEditedSale(){
      const name = sellName.value.trim(),
            type = sellType.value.trim(),
            ram = sellRam.value.trim(),
            stor = sellStorage.value.trim(),
            qty = parseInt(sellQty.value.trim());

      if(!name||!type||!ram||!stor||isNaN(qty)||qty<=0){
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"); 
        return;
      }

      const oldSale = sales[editSaleIndex];
      const oldQty = oldSale.qty;

      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ù…Ø®Ø²Ù† Ø£ÙˆÙ„Ø§Ù‹
      let oldStorageIndex = storage.findIndex(p=>p.name===oldSale.name&&p.type===oldSale.type&&p.ram===oldSale.ram&&p.storage===oldSale.storage);
      if(oldStorageIndex !== -1){
        storage[oldStorageIndex].qty += oldQty;
      }else{
        storage.push({name:oldSale.name,type:oldSale.type,ram:oldSale.ram,storage:oldSale.storage,qty:oldQty});
      }

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      let newStorageIndex = storage.findIndex(p=>p.name===name&&p.type===type&&p.ram===ram&&p.storage===stor);
      if(newStorageIndex === -1 || storage[newStorageIndex].qty < qty){
        alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©");
        return;
      }

      // Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      storage[newStorageIndex].qty -= qty;
      if(storage[newStorageIndex].qty === 0) storage.splice(newStorageIndex,1);

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
      sales[editSaleIndex] = {name,type,ram,storage:stor,qty};

      editSaleIndex = null;
      saveData();
      renderStockTable();
      renderSalesTable();
      updateStats();
      clearSellForm();
      alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª");
    }

    // Ø­Ø°Ù Ø³Ø¬Ù„ Ø¨ÙŠØ¹ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù…Ø®Ø²Ù†
    function deleteSale(index){
      const s = sales[index];
      let idx = storage.findIndex(p=>p.name===s.name&&p.type===s.type&&p.ram===s.ram&&p.storage===s.storage);
      if(idx !== -1){
        storage[idx].qty += s.qty;
      }else{
        storage.push({name:s.name,type:s.type,ram:s.ram,storage:s.storage,qty:s.qty});
      }
      sales.splice(index,1);
      saveData();
      renderStockTable();
      renderSalesTable();
      updateStats();
      alert("ØªÙ… Ø­Ø°Ù Ø³Ø¬Ù„ Ø§Ù„Ø¨ÙŠØ¹ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙƒÙ…ÙŠØ© Ù„Ù„Ù…Ø®Ø²Ù†");
    }

    // Ø²Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø£Ùˆ Ø­ÙØ¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹
    function sellBtnHandler(){
      if(editSaleIndex !== null) saveEditedSale();
      else sellPhone();
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
    function updateStats(){
      totalStock.textContent = storage.length;
      totalSold.textContent  = sales.reduce((a,c)=>a+c.qty,0);
      stockQty.textContent   = storage.reduce((a,c)=>a+c.qty,0);
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    renderStockTable();
    renderSalesTable();
    updateStats();

  </script>
</body>
</html>
